---
globs: *.cs
description: C# coding standards and best practices for Unity development
---

# C# ì½”ë”© í‘œì¤€

Unity í”„ë¡œì íŠ¸ì˜ C# ì½”ë“œ í’ˆì§ˆê³¼ ì¼ê´€ì„±ì„ ìœ„í•œ í‘œì¤€ì…ë‹ˆë‹¤.

## ğŸ¯ ì½”ë”© ìŠ¤íƒ€ì¼

### ë“¤ì—¬ì“°ê¸° ë° í¬ë§·íŒ…
- 4 ìŠ¤í˜ì´ìŠ¤ ë“¤ì—¬ì“°ê¸° ì‚¬ìš© (íƒ­ ì•„ë‹˜)
- ì¤‘ê´„í˜¸ëŠ” ìƒˆ ì¤„ì—ì„œ ì‹œì‘ (Allman style)
- í•œ ì¤„ì— í•˜ë‚˜ì˜ ëª…ë ¹ë¬¸ë§Œ ì‘ì„±

```csharp
// ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
if (condition)
{
    DoSomething();
    DoAnotherThing();
}

// ì˜ëª»ëœ ì˜ˆì‹œ
if (condition) { DoSomething(); DoAnotherThing(); }
```

### ì ‘ê·¼ ì œí•œì
- ëª¨ë“  ë©¤ë²„ì— ëª…ì‹œì ìœ¼ë¡œ ì ‘ê·¼ ì œí•œì ì‘ì„±
- private ë©¤ë²„ë„ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±

```csharp
public class PlayerModel
{
    private PlayerStatusData statusData;  // private ëª…ì‹œ
    public string Nickname { get; set; }  // public ëª…ì‹œ
    
    private void UpdateStatus()           // private ëª…ì‹œ
    {
        // êµ¬í˜„
    }
}
```

## ğŸ—ï¸ í´ë˜ìŠ¤ êµ¬ì¡°

### ë©¤ë²„ ìˆœì„œ
1. ìƒìˆ˜ (const)
2. ì •ì  í•„ë“œ (static fields)
3. ì¸ìŠ¤í„´ìŠ¤ í•„ë“œ (instance fields)
4. í”„ë¡œí¼í‹° (properties)
5. ì´ë²¤íŠ¸ (events)
6. ìƒì„±ì (constructors)
7. ë©”ì„œë“œ (methods)

```csharp
public class CardItemFactoryManager : NetworkBehaviour
{
    #region ì‹±ê¸€í†¤ ì½”ë“œ
    private static CardItemFactoryManager _instance;
    public static CardItemFactoryManager Instance { get; }
    #endregion

    #region í•„ë“œ
    private readonly Dictionary<int, CardDef> _cards = new();
    public GameObject cardItemForSalePrefab;
    #endregion

    #region í”„ë¡œí¼í‹°
    public IReadOnlyDictionary<int, CardDef> Cards => _cards;
    #endregion

    #region ì´ë²¤íŠ¸
    public Action OnCardForSaleCreated;
    #endregion

    #region Unity ë¼ì´í”„ì‚¬ì´í´
    private void Awake() { }
    private void Start() { }
    private void OnDestroy() { }
    #endregion

    #region Public ë©”ì„œë“œ
    public void CreateCardForSale(int cardId, Vector3 position) { }
    #endregion

    #region Private ë©”ì„œë“œ
    private void ValidateCardRequest() { }
    #endregion
}
```

### Region ì‚¬ìš©
- ê´€ë ¨ ì½”ë“œë¥¼ `#region`ìœ¼ë¡œ ê·¸ë£¹í™”
- ì‹±ê¸€í†¤, í•„ë“œ, ë©”ì„œë“œ ë“±ìœ¼ë¡œ êµ¬ë¶„
- ê¸´ í´ë˜ìŠ¤ì˜ ê°€ë…ì„± í–¥ìƒ

## ğŸ”§ MVP íŒ¨í„´ êµ¬í˜„

### Model í´ë˜ìŠ¤
- ë°ì´í„°ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ í¬í•¨
- UI ê´€ë ¨ ì½”ë“œ ê¸ˆì§€

```csharp
public class CardDataModel
{
    private readonly Dictionary<int, CardDef> _cards = new();
    
    public bool TryGetCard(int cardId, out CardDef cardDef)
    {
        return _cards.TryGetValue(cardId, out cardDef);
    }
}
```

### View í´ë˜ìŠ¤
- UI í‘œì‹œì™€ ì‚¬ìš©ì ì…ë ¥ë§Œ ì²˜ë¦¬
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê¸ˆì§€

```csharp
public class PlayerView : MonoBehaviour
{
    public event EventHandler<OnMovementInputEventArgs> OnMovementInput;
    
    private void Update()
    {
        // ì…ë ¥ ì²˜ë¦¬ë§Œ
        if (Input.GetKey(KeyCode.W))
        {
            OnMovementInput?.Invoke(this, new OnMovementInputEventArgs { YDirection = 1 });
        }
    }
}
```

### Presenter í´ë˜ìŠ¤
- Modelê³¼ View ì‚¬ì´ì˜ ì¤‘ì¬ì
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ UI ë¡œì§ ì—°ê²°

```csharp
public class PlayerPresenter : NetworkBehaviour
{
    private PlayerModel playerModel;
    private PlayerView playerView;
    
    private void Start()
    {
        playerModel = GetComponent<PlayerModel>();
        playerView = GetComponent<PlayerView>();
        
        // ì´ë²¤íŠ¸ ë°”ì¸ë”©
        playerView.OnMovementInput += HandleMovementInput;
    }
    
    private void HandleMovementInput(object sender, OnMovementInputEventArgs e)
    {
        playerModel.MovePlayerServerRpc(e.XDirection, e.YDirection);
    }
}
```

## ğŸ² Unity íŠ¹í™” íŒ¨í„´

### NetworkBehaviour íŒ¨í„´
- ServerRpcì™€ ClientRpc ì ì ˆíˆ í™œìš©
- NetworkVariable ì‚¬ìš© ì‹œ OnValueChanged ì´ë²¤íŠ¸ êµ¬ë…

```csharp
public class PlayerModel : NetworkBehaviour
{
    public NetworkVariable<PlayerStatusData> PlayerStatusData = new();
    
    [ServerRpc]
    public void MovePlayerServerRpc(float x, float y)
    {
        // ì„œë²„ì—ì„œë§Œ ì‹¤í–‰ë˜ëŠ” ë¡œì§
    }
    
    [ClientRpc]
    public void UpdateAnimationClientRpc(PlayerAnimationState state)
    {
        // ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¡œì§
    }
}
```

### ì‹±ê¸€í†¤ íŒ¨í„´ (Object Composition)
- ìƒì†ë³´ë‹¤ëŠ” ì¡°í•© ë°©ì‹ ì„ í˜¸
- DontDestroyOnLoad ì ì ˆíˆ í™œìš©

```csharp
public class GameManager : NetworkBehaviour
{
    private static GameManager _instance;
    
    public static GameManager Instance
    {
        get
        {
            if (_instance == null)
            {
                _instance = FindObjectOfType<GameManager>();
                if (_instance == null)
                {
                    GameObject go = new GameObject("GameManager");
                    _instance = go.AddComponent<GameManager>();
                }
            }
            return _instance;
        }
    }
    
    private void Awake()
    {
        if (_instance == null)
        {
            _instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else if (_instance != this)
        {
            Destroy(gameObject);
        }
    }
}
```

## ğŸš¨ ì—ëŸ¬ ì²˜ë¦¬

### ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°
- null ì²´í¬ ì² ì €íˆ ìˆ˜í–‰
- ì˜ˆì™¸ ìƒí™©ì— ëŒ€í•œ ì ì ˆí•œ ë¡œê¹…

```csharp
public void CreateCard(CardDef cardDef)
{
    if (cardDef == null)
    {
        Debug.LogError("[CardFactory] CardDefê°€ nullì…ë‹ˆë‹¤.");
        return;
    }
    
    if (string.IsNullOrEmpty(cardDef.CardNameKey))
    {
        Debug.LogWarning($"[CardFactory] CardID {cardDef.CardID}ì˜ ì´ë¦„ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
    }
    
    // ì¹´ë“œ ìƒì„± ë¡œì§
}
```

### ë¡œê¹… ê·œì¹™
- `Debug.Log`: ì¼ë°˜ ì •ë³´
- `Debug.LogWarning`: ê²½ê³  (ê²Œì„ ì§„í–‰ì—ëŠ” ë¬¸ì œì—†ìŒ)
- `Debug.LogError`: ì—ëŸ¬ (ê²Œì„ ì§„í–‰ì— ë¬¸ì œ ìˆìŒ)
- ë¡œê·¸ ë©”ì‹œì§€ì— í´ë˜ìŠ¤ëª… í¬í•¨: `[ClassName] ë©”ì‹œì§€`

## ğŸ”„ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

### async/await íŒ¨í„´
- Unityì˜ async/await ì ì ˆíˆ í™œìš©
- CancellationToken ì‚¬ìš©ìœ¼ë¡œ ì·¨ì†Œ ê°€ëŠ¥í•œ ì‘ì—… êµ¬í˜„

```csharp
public sealed class CardDataPresenter
{
    public async Task PreloadAsync(string cardCsvUrl, CancellationToken ct = default)
    {
        try
        {
            var cardData = await GetTextAsync(cardCsvUrl, ct);
            ProcessCardData(cardData);
        }
        catch (System.Exception ex)
        {
            Debug.LogError($"[CardDataPresenter] ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: {ex.Message}");
        }
    }
}
```

ì´ í‘œì¤€ì„ ë”°ë¼ ì¼ê´€ì„± ìˆê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ C# ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.